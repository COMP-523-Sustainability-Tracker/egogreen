import { Directive, Component, ElementRef, Optional } from '@angular/core';
import { ActionBar, ActionItem, NavigationButton, Page } from '@nativescript/core';
import { isBlank } from '../../utils/lang-facade';
import { isInvisibleNode, isView } from '../../views/utils';
import { registerElement } from '../../element-registry';
import * as i0 from "@angular/core";
import * as i1 from "@nativescript/core";
export function isActionItem(view) {
    return view instanceof ActionItem;
}
export function isNavigationButton(view) {
    return view instanceof NavigationButton;
}
export const actionBarMeta = {
    skipAddToDom: true,
    insertChild: (parent, child, next) => {
        if (isInvisibleNode(child)) {
            return;
        }
        else if (isNavigationButton(child)) {
            parent.navigationButton = child;
            child.parentNode = parent;
        }
        else if (isActionItem(child)) {
            addActionItem(parent, child, next);
            child.parentNode = parent;
        }
        else if (isView(child)) {
            parent.titleView = child;
        }
    },
    removeChild: (parent, child) => {
        if (isInvisibleNode(child)) {
            return;
        }
        else if (isNavigationButton(child)) {
            if (parent.navigationButton === child) {
                parent.navigationButton = null;
            }
            child.parentNode = null;
        }
        else if (isActionItem(child)) {
            parent.actionItems.removeItem(child);
            child.parentNode = null;
        }
        else if (isView(child) && parent.titleView && parent.titleView === child) {
            parent.titleView = null;
        }
    },
};
registerElement('ActionBar', () => ActionBar, actionBarMeta);
registerElement('ActionItem', () => ActionItem);
registerElement('NavigationButton', () => NavigationButton);
const addActionItem = (bar, item, next) => {
    if (next) {
        insertActionItemBefore(bar, item, next);
    }
    else {
        appendActionItem(bar, item);
    }
};
const insertActionItemBefore = (bar, item, next) => {
    const actionItems = bar.actionItems;
    const actionItemsCollection = actionItems.getItems();
    const indexToInsert = actionItemsCollection.indexOf(next);
    actionItemsCollection.splice(indexToInsert, 0, item);
    actionItems.setItems(actionItemsCollection);
};
const appendActionItem = (bar, item) => {
    bar.actionItems.addItem(item);
};
class ActionBarComponent {
    constructor(element, page) {
        this.element = element;
        this.page = page;
        if (!this.page) {
            throw new Error('No Page found in ActionBarComponent.\n' + 'Only a Page can contain an ActionBar, so please ensure ActionBar is only used inside a Component that is routed via page-router-outlet or is contained in a Page.\n' + 'Example for root action bars in AppComponent: <Frame><Page><ActionBar>....</ActionBar></Page></Frame>');
        }
        if (isBlank(this.page.actionBarHidden)) {
            this.page.actionBarHidden = false;
        }
        this.page.actionBar = this.element.nativeElement;
        this.page.actionBar.update();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.1", ngImport: i0, type: ActionBarComponent, deps: [{ token: i0.ElementRef }, { token: i1.Page, optional: true }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.0.1", type: ActionBarComponent, selector: "ActionBar", ngImport: i0, template: '<ng-content></ng-content>', isInline: true }); }
}
export { ActionBarComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.1", ngImport: i0, type: ActionBarComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'ActionBar',
                    template: '<ng-content></ng-content>',
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.Page, decorators: [{
                    type: Optional
                }] }]; } });
class ActionBarScope {
    // tslint:disable-line:component-class-suffix
    constructor(page) {
        this.page = page;
        if (!this.page) {
            throw new Error('Inside ActionBarExtension but no ActionBar found to extend.');
        }
    }
    onNavButtonInit(navBtn) {
        this.page.actionBar.navigationButton = navBtn.element.nativeElement;
    }
    onNavButtonDestroy(navBtn) {
        const nav = navBtn.element.nativeElement;
        if (nav && this.page.actionBar.navigationButton === nav) {
            this.page.actionBar.navigationButton = null;
        }
    }
    onActionInit(item) {
        this.page.actionBar.actionItems.addItem(item.element.nativeElement);
    }
    onActionDestroy(item) {
        if (item.element.nativeElement.actionBar) {
            this.page.actionBar.actionItems.removeItem(item.element.nativeElement);
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.1", ngImport: i0, type: ActionBarScope, deps: [{ token: i1.Page, optional: true }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.0.1", type: ActionBarScope, selector: "ActionBarExtension", ngImport: i0, template: '', isInline: true }); }
}
export { ActionBarScope };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.1", ngImport: i0, type: ActionBarScope, decorators: [{
            type: Component,
            args: [{
                    selector: 'ActionBarExtension',
                    template: '',
                }]
        }], ctorParameters: function () { return [{ type: i1.Page, decorators: [{
                    type: Optional
                }] }]; } });
class ActionItemDirective {
    constructor(element, ownerScope) {
        this.element = element;
        this.ownerScope = ownerScope;
        if (this.ownerScope) {
            this.ownerScope.onActionInit(this);
        }
    }
    ngOnDestroy() {
        if (this.ownerScope) {
            this.ownerScope.onActionDestroy(this);
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.1", ngImport: i0, type: ActionItemDirective, deps: [{ token: i0.ElementRef }, { token: ActionBarScope, optional: true }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.0.1", type: ActionItemDirective, selector: "ActionItem", ngImport: i0 }); }
}
export { ActionItemDirective };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.1", ngImport: i0, type: ActionItemDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'ActionItem', // tslint:disable-line:directive-selector
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: ActionBarScope, decorators: [{
                    type: Optional
                }] }]; } });
class NavigationButtonDirective {
    constructor(element, ownerScope) {
        this.element = element;
        this.ownerScope = ownerScope;
        if (this.ownerScope) {
            this.ownerScope.onNavButtonInit(this);
        }
    }
    ngOnDestroy() {
        if (this.ownerScope) {
            this.ownerScope.onNavButtonDestroy(this);
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.1", ngImport: i0, type: NavigationButtonDirective, deps: [{ token: i0.ElementRef }, { token: ActionBarScope, optional: true }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.0.1", type: NavigationButtonDirective, selector: "NavigationButton", ngImport: i0 }); }
}
export { NavigationButtonDirective };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.1", ngImport: i0, type: NavigationButtonDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'NavigationButton', // tslint:disable-line:directive-selector
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: ActionBarScope, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9hbmd1bGFyL3NyYy9saWIvY2RrL2FjdGlvbi1iYXIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUN0RixPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBZSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVoRyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7OztBQUV6RCxNQUFNLFVBQVUsWUFBWSxDQUFDLElBQVM7SUFDcEMsT0FBTyxJQUFJLFlBQVksVUFBVSxDQUFDO0FBQ3BDLENBQUM7QUFFRCxNQUFNLFVBQVUsa0JBQWtCLENBQUMsSUFBUztJQUMxQyxPQUFPLElBQUksWUFBWSxnQkFBZ0IsQ0FBQztBQUMxQyxDQUFDO0FBSUQsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFrQjtJQUMxQyxZQUFZLEVBQUUsSUFBSTtJQUNsQixXQUFXLEVBQUUsQ0FBQyxNQUFtQixFQUFFLEtBQWEsRUFBRSxJQUFTLEVBQUUsRUFBRTtRQUM3RCxJQUFJLGVBQWUsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMxQixPQUFPO1NBQ1I7YUFBTSxJQUFJLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3BDLE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7WUFDaEMsS0FBSyxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUM7U0FDM0I7YUFBTSxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsRUFB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QU8sQ0FBWTtRQUFzQixlQUFVLEdBQVYsVUFBVSxDQUFnQjtRQUNwRixJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDbkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDdkM7SUFDSCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNuQixJQUFJLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzFDO0lBQ0gsQ0FBQzs4R0FYVSx5QkFBeUI7a0dBQXpCLHlCQUF5Qjs7U0FBekIseUJBQXlCOzJGQUF6Qix5QkFBeUI7a0JBSHJDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLGtCQUFrQixFQUFFLHlDQUF5QztpQkFDeEU7OzBCQUUwQyxRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIE9wdGlvbmFsLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGlvbkJhciwgQWN0aW9uSXRlbSwgQWN0aW9uSXRlbXMsIE5hdmlnYXRpb25CdXR0b24sIFBhZ2UgfSBmcm9tICdAbmF0aXZlc2NyaXB0L2NvcmUnO1xuXG5pbXBvcnQgeyBpc0JsYW5rIH0gZnJvbSAnLi4vLi4vdXRpbHMvbGFuZy1mYWNhZGUnO1xuaW1wb3J0IHsgTmdWaWV3LCBWaWV3Q2xhc3NNZXRhLCBWaWV3RXh0ZW5zaW9ucyB9IGZyb20gJy4uLy4uL3ZpZXdzL3ZpZXctdHlwZXMnO1xuaW1wb3J0IHsgaXNJbnZpc2libGVOb2RlLCBpc1ZpZXcgfSBmcm9tICcuLi8uLi92aWV3cy91dGlscyc7XG5pbXBvcnQgeyByZWdpc3RlckVsZW1lbnQgfSBmcm9tICcuLi8uLi9lbGVtZW50LXJlZ2lzdHJ5JztcblxuZXhwb3J0IGZ1bmN0aW9uIGlzQWN0aW9uSXRlbSh2aWV3OiBhbnkpOiB2aWV3IGlzIEFjdGlvbkl0ZW0ge1xuICByZXR1cm4gdmlldyBpbnN0YW5jZW9mIEFjdGlvbkl0ZW07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc05hdmlnYXRpb25CdXR0b24odmlldzogYW55KTogdmlldyBpcyBOYXZpZ2F0aW9uQnV0dG9uIHtcbiAgcmV0dXJuIHZpZXcgaW5zdGFuY2VvZiBOYXZpZ2F0aW9uQnV0dG9uO1xufVxuXG50eXBlIE5nQWN0aW9uQmFyID0gQWN0aW9uQmFyICYgVmlld0V4dGVuc2lvbnM7XG5cbmV4cG9ydCBjb25zdCBhY3Rpb25CYXJNZXRhOiBWaWV3Q2xhc3NNZXRhID0ge1xuICBza2lwQWRkVG9Eb206IHRydWUsXG4gIGluc2VydENoaWxkOiAocGFyZW50OiBOZ0FjdGlvbkJhciwgY2hpbGQ6IE5nVmlldywgbmV4dDogYW55KSA9PiB7XG4gICAgaWYgKGlzSW52aXNpYmxlTm9kZShjaGlsZCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKGlzTmF2aWdhdGlvbkJ1dHRvbihjaGlsZCkpIHtcbiAgICAgIHBhcmVudC5uYXZpZ2F0aW9uQnV0dG9uID0gY2hpbGQ7XG4gICAgICBjaGlsZC5wYXJlbnROb2RlID0gcGFyZW50O1xuICAgIH0gZWxzZSBpZiAoaXNBY3Rpb25JdGVtKGNoaWxkKSkge1xuICAgICAgYWRkQWN0aW9uSXRlbShwYXJlbnQsIGNoaWxkLCBuZXh0KTtcbiAgICAgIGNoaWxkLnBhcmVudE5vZGUgPSBwYXJlbnQ7XG4gICAgfSBlbHNlIGlmIChpc1ZpZXcoY2hpbGQpKSB7XG4gICAgICBwYXJlbnQudGl0bGVWaWV3ID0gY2hpbGQ7XG4gICAgfVxuICB9LFxuICByZW1vdmVDaGlsZDogKHBhcmVudDogTmdBY3Rpb25CYXIsIGNoaWxkOiBOZ1ZpZXcpID0+IHtcbiAgICBpZiAoaXNJbnZpc2libGVOb2RlKGNoaWxkKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAoaXNOYXZpZ2F0aW9uQnV0dG9uKGNoaWxkKSkge1xuICAgICAgaWYgKHBhcmVudC5uYXZpZ2F0aW9uQnV0dG9uID09PSBjaGlsZCkge1xuICAgICAgICBwYXJlbnQubmF2aWdhdGlvbkJ1dHRvbiA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIGNoaWxkLnBhcmVudE5vZGUgPSBudWxsO1xuICAgIH0gZWxzZSBpZiAoaXNBY3Rpb25JdGVtKGNoaWxkKSkge1xuICAgICAgcGFyZW50LmFjdGlvbkl0ZW1zLnJlbW92ZUl0ZW0oY2hpbGQpO1xuICAgICAgY2hpbGQucGFyZW50Tm9kZSA9IG51bGw7XG4gICAgfSBlbHNlIGlmIChpc1ZpZXcoY2hpbGQpICYmIHBhcmVudC50aXRsZVZpZXcgJiYgcGFyZW50LnRpdGxlVmlldyA9PT0gY2hpbGQpIHtcbiAgICAgIHBhcmVudC50aXRsZVZpZXcgPSBudWxsO1xuICAgIH1cbiAgfSxcbn07XG5cbnJlZ2lzdGVyRWxlbWVudCgnQWN0aW9uQmFyJywgKCkgPT4gQWN0aW9uQmFyLCBhY3Rpb25CYXJNZXRhKTtcbnJlZ2lzdGVyRWxlbWVudCgnQWN0aW9uSXRlbScsICgpID0+IDxhbnk+QWN0aW9uSXRlbSk7XG5yZWdpc3RlckVsZW1lbnQoJ05hdmlnYXRpb25CdXR0b24nLCAoKSA9PiA8YW55Pk5hdmlnYXRpb25CdXR0b24pO1xuXG5jb25zdCBhZGRBY3Rpb25JdGVtID0gKGJhcjogTmdBY3Rpb25CYXIsIGl0ZW06IEFjdGlvbkl0ZW0sIG5leHQ6IEFjdGlvbkl0ZW0pID0+IHtcbiAgaWYgKG5leHQpIHtcbiAgICBpbnNlcnRBY3Rpb25JdGVtQmVmb3JlKGJhciwgaXRlbSwgbmV4dCk7XG4gIH0gZWxzZSB7XG4gICAgYXBwZW5kQWN0aW9uSXRlbShiYXIsIGl0ZW0pO1xuICB9XG59O1xuXG5jb25zdCBpbnNlcnRBY3Rpb25JdGVtQmVmb3JlID0gKGJhcjogTmdBY3Rpb25CYXIsIGl0ZW06IEFjdGlvbkl0ZW0sIG5leHQ6IEFjdGlvbkl0ZW0pID0+IHtcbiAgY29uc3QgYWN0aW9uSXRlbXM6IEFjdGlvbkl0ZW1zID0gYmFyLmFjdGlvbkl0ZW1zO1xuICBjb25zdCBhY3Rpb25JdGVtc0NvbGxlY3Rpb246IEFjdGlvbkl0ZW1bXSA9IGFjdGlvbkl0ZW1zLmdldEl0ZW1zKCk7XG5cbiAgY29uc3QgaW5kZXhUb0luc2VydCA9IGFjdGlvbkl0ZW1zQ29sbGVjdGlvbi5pbmRleE9mKG5leHQpO1xuICBhY3Rpb25JdGVtc0NvbGxlY3Rpb24uc3BsaWNlKGluZGV4VG9JbnNlcnQsIDAsIGl0ZW0pO1xuXG4gICg8YW55PmFjdGlvbkl0ZW1zKS5zZXRJdGVtcyhhY3Rpb25JdGVtc0NvbGxlY3Rpb24pO1xufTtcblxuY29uc3QgYXBwZW5kQWN0aW9uSXRlbSA9IChiYXI6IE5nQWN0aW9uQmFyLCBpdGVtOiBBY3Rpb25JdGVtKSA9PiB7XG4gIGJhci5hY3Rpb25JdGVtcy5hZGRJdGVtKGl0ZW0pO1xufTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnQWN0aW9uQmFyJyxcbiAgdGVtcGxhdGU6ICc8bmctY29udGVudD48L25nLWNvbnRlbnQ+Jyxcbn0pXG5leHBvcnQgY2xhc3MgQWN0aW9uQmFyQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHVibGljIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIEBPcHRpb25hbCgpIHByaXZhdGUgcGFnZTogUGFnZSkge1xuICAgIGlmICghdGhpcy5wYWdlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIFBhZ2UgZm91bmQgaW4gQWN0aW9uQmFyQ29tcG9uZW50LlxcbicgKyAnT25seSBhIFBhZ2UgY2FuIGNvbnRhaW4gYW4gQWN0aW9uQmFyLCBzbyBwbGVhc2UgZW5zdXJlIEFjdGlvbkJhciBpcyBvbmx5IHVzZWQgaW5zaWRlIGEgQ29tcG9uZW50IHRoYXQgaXMgcm91dGVkIHZpYSBwYWdlLXJvdXRlci1vdXRsZXQgb3IgaXMgY29udGFpbmVkIGluIGEgUGFnZS5cXG4nICsgJ0V4YW1wbGUgZm9yIHJvb3QgYWN0aW9uIGJhcnMgaW4gQXBwQ29tcG9uZW50OiA8RnJhbWU+PFBhZ2U+PEFjdGlvbkJhcj4uLi4uPC9BY3Rpb25CYXI+PC9QYWdlPjwvRnJhbWU+Jyk7XG4gICAgfVxuXG4gICAgaWYgKGlzQmxhbmsodGhpcy5wYWdlLmFjdGlvbkJhckhpZGRlbikpIHtcbiAgICAgIHRoaXMucGFnZS5hY3Rpb25CYXJIaWRkZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5wYWdlLmFjdGlvbkJhciA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICAgIHRoaXMucGFnZS5hY3Rpb25CYXIudXBkYXRlKCk7XG4gIH1cbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnQWN0aW9uQmFyRXh0ZW5zaW9uJyxcbiAgdGVtcGxhdGU6ICcnLFxufSlcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvY29tcG9uZW50LWNsYXNzLXN1ZmZpeFxuZXhwb3J0IGNsYXNzIEFjdGlvbkJhclNjb3BlIHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbGluZTpjb21wb25lbnQtY2xhc3Mtc3VmZml4XG4gIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIHByaXZhdGUgcGFnZTogUGFnZSkge1xuICAgIGlmICghdGhpcy5wYWdlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0luc2lkZSBBY3Rpb25CYXJFeHRlbnNpb24gYnV0IG5vIEFjdGlvbkJhciBmb3VuZCB0byBleHRlbmQuJyk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG9uTmF2QnV0dG9uSW5pdChuYXZCdG46IE5hdmlnYXRpb25CdXR0b25EaXJlY3RpdmUpIHtcbiAgICB0aGlzLnBhZ2UuYWN0aW9uQmFyLm5hdmlnYXRpb25CdXR0b24gPSBuYXZCdG4uZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICB9XG5cbiAgcHVibGljIG9uTmF2QnV0dG9uRGVzdHJveShuYXZCdG46IE5hdmlnYXRpb25CdXR0b25EaXJlY3RpdmUpIHtcbiAgICBjb25zdCBuYXYgPSA8TmF2aWdhdGlvbkJ1dHRvbj5uYXZCdG4uZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICAgIGlmIChuYXYgJiYgdGhpcy5wYWdlLmFjdGlvbkJhci5uYXZpZ2F0aW9uQnV0dG9uID09PSBuYXYpIHtcbiAgICAgIHRoaXMucGFnZS5hY3Rpb25CYXIubmF2aWdhdGlvbkJ1dHRvbiA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG9uQWN0aW9uSW5pdChpdGVtOiBBY3Rpb25JdGVtRGlyZWN0aXZlKSB7XG4gICAgdGhpcy5wYWdlLmFjdGlvbkJhci5hY3Rpb25JdGVtcy5hZGRJdGVtKGl0ZW0uZWxlbWVudC5uYXRpdmVFbGVtZW50KTtcbiAgfVxuXG4gIHB1YmxpYyBvbkFjdGlvbkRlc3Ryb3koaXRlbTogQWN0aW9uSXRlbURpcmVjdGl2ZSkge1xuICAgIGlmIChpdGVtLmVsZW1lbnQubmF0aXZlRWxlbWVudC5hY3Rpb25CYXIpIHtcbiAgICAgIHRoaXMucGFnZS5hY3Rpb25CYXIuYWN0aW9uSXRlbXMucmVtb3ZlSXRlbShpdGVtLmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG4gICAgfVxuICB9XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ0FjdGlvbkl0ZW0nLCAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOmRpcmVjdGl2ZS1zZWxlY3RvclxufSlcbmV4cG9ydCBjbGFzcyBBY3Rpb25JdGVtRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgY29uc3RydWN0b3IocHVibGljIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIEBPcHRpb25hbCgpIHByaXZhdGUgb3duZXJTY29wZTogQWN0aW9uQmFyU2NvcGUpIHtcbiAgICBpZiAodGhpcy5vd25lclNjb3BlKSB7XG4gICAgICB0aGlzLm93bmVyU2NvcGUub25BY3Rpb25Jbml0KHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLm93bmVyU2NvcGUpIHtcbiAgICAgIHRoaXMub3duZXJTY29wZS5vbkFjdGlvbkRlc3Ryb3kodGhpcyk7XG4gICAgfVxuICB9XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ05hdmlnYXRpb25CdXR0b24nLCAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOmRpcmVjdGl2ZS1zZWxlY3RvclxufSlcbmV4cG9ydCBjbGFzcyBOYXZpZ2F0aW9uQnV0dG9uRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgY29uc3RydWN0b3IocHVibGljIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIEBPcHRpb25hbCgpIHByaXZhdGUgb3duZXJTY29wZTogQWN0aW9uQmFyU2NvcGUpIHtcbiAgICBpZiAodGhpcy5vd25lclNjb3BlKSB7XG4gICAgICB0aGlzLm93bmVyU2NvcGUub25OYXZCdXR0b25Jbml0KHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLm93bmVyU2NvcGUpIHtcbiAgICAgIHRoaXMub3duZXJTY29wZS5vbk5hdkJ1dHRvbkRlc3Ryb3kodGhpcyk7XG4gICAgfVxuICB9XG59XG4iXX0=